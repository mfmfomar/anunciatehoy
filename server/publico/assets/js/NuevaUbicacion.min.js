function updateImagecomplete(){$("#myModalUbicacion_publicada").modal("toggle")}updateImage=function(e,a){var o,t,n,i;return i=0,Dropzone.autoDiscover=!1,Dropzone.options.portadaForm={headers:{Authorization:localStorage.getItem("token")},maxFilesize:1,parallelUploads:10,uploadMultiple:!0,autoProcessQueue:!1,addRemoveLinks:!0,maxFiles:e,dictResponseError:"Server not Configured",acceptedFiles:".png,.jpg,.gif,.bmp,.jpeg",paramName:"fileImage",init:function(){var e=this;e.options.addRemoveLinks=!0,e.options.dictRemoveFile="Delete",e.on("addedfile",function(e){$(".dz-preview").first().addClass("DZportada"),t=$(".DZportada>.dz-details>.dz-filename>span").html(),$("#imgPortada").val(t),i++,$("#foto").val(i),console.log("new file added ",e)}),e.on("sending",function(e,a,o){o.append("portadaName",t),$("#imgPortada").val(t);for(var i=0;i<n.length;i++)o.append(n[i].name,n[i].value);console.log("upload started",e)}),e.on("totaluploadprogress",function(e){console.log("progress ",e),$("#progres").width(e+"%")}),e.on("complete",function(e){console.log("complete"),0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&(console.log("complete All"),a())}),e.on("success",function(e,a){console.log("done"),o.options.autoProcessQueue=!0}),e.on("removedfile",function(e){console.log(e),i--,$(".dz-preview").first().addClass("DZportada"),t=$(".DZportada>.dz-details>.dz-filename>span").html(),$("#imgPortada").val(t),i<1&&$("#foto").val("")})}},o=new Dropzone("#portadaForm"),{enviar:function(e){n=e,o.processQueue()},portadaName:function(){return console.log(t),t}}};var form=$(".steps-validation").show();$(".steps-validation").steps({headerTag:"h6",bodyTag:"fieldset",transitionEffect:"fade",titleTemplate:'<span class="step">#index#</span> #title#',labels:{finish:"Submit"},onStepChanging:function(e,a,o){return o<a||(a<o&&(form.find(".body:eq("+o+") label.error").remove(),form.find(".body:eq("+o+") .error").removeClass("error")),form.validate().settings.ignore=":disabled,:hidden",form.valid())},onFinishing:function(e,a){return form.validate().settings.ignore=":disabled",form.valid()},onFinished:function(e,a){app.nuevaUbicacion()}}),$(".steps-validation").validate({ignore:"input[type=hidden]",errorClass:"danger",successClass:"success",highlight:function(e,a){$(e).removeClass(a)},unhighlight:function(e,a){$(e).removeClass(a)},errorPlacement:function(e,a){e.insertAfter(a)},rules:{email:{email:!0}}});var updateImage=new updateImage(10,updateImagecomplete);$(document).ready(function(){mapa=MAPA("/publico/assets/img/"),mapa.initialize(),mapa.SetPin(),$("#mipos").click(function(){console.log("click"),mapa.UbicacionActual()}),$("#nuevo").click(function(e){$("#enviar").click()})});var api="api/nuevaUbicacion/",app=new Vue({el:".vv",created:function(){},data:{ubicacion:{nombre:"",tipo:"",costo:"",descripcion:"",ubicacion:{lat:"",lng:""},imgPortada:"default.jpg",colonia:"",calle:"",numero:"",propietario:"",galeria:null,tabla:null},TipoUbicacion:[{value:"casa",name:"Casa",i18n:"Casa"},{value:"compartido",name:"Casa Compartida",i18n:"Casa Compartida"},{value:"departamento",name:"Departamento",i18n:"Departamento"},{value:"hostal",name:"Hostal",i18n:"Hostal"},{value:"hotel",name:"Hotel",i18n:"Hotel"},{value:"motel",name:"Motel",i18n:"Motel"},{value:"oficina",name:"Oficina",i18n:"Oficina"},{value:"terreno",name:"Terreno",i18n:"Terreno"}],selectedOption:""},methods:{setDatos:function(){this.ubicacion.tipo=this.selectedOption,"casa"===this.selectedOption||"compartido"===this.selectedOption||"departamento"===this.selectedOption||"terreno"===this.selectedOption||"oficina"===this.selectedOption?this.ubicacion.tabla="propiedad":"hostal"!==this.selectedOption&&"hotel"!==this.selectedOption&&"motel"!==this.selectedOption||(this.ubicacion.tabla="hospedaje"),this.ubicacion.ubicacion.lat=window.tmplat,this.ubicacion.ubicacion.lng=window.tmplng},nuevaUbicacion:function(){this.ubicacion.ubicacion.lat=window.tmplat,this.ubicacion.ubicacion.lng=window.tmplng,this.ubicacion.imgPortada=$(".DZportada>.dz-details>.dz-filename>span").html(),this.$http.post(api,this.ubicacion,{headers:{Authorization:localStorage.getItem("token")}}).then(function(e){var a=[{name:"id",value:e.data.ubicacion._id},{name:"categoria",value:e.data.ubicacion.categoria},{name:"tipo",value:e.data.ubicacion.tipo}];updateImage.enviar(a)})}}});